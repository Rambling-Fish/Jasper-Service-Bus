<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:udp="http://www.mulesoft.org/schema/mule/udp" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:spring="http://www.springframework.org/schema/beans" xmlns:core="http://www.mulesoft.org/schema/mule/core" xmlns:jasperengine="http://www.mulesoft.org/schema/mule/jasperengine" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" version="CE-3.3.0" xsi:schemaLocation="
http://www.mulesoft.org/schema/mule/udp http://www.mulesoft.org/schema/mule/udp/current/mule-udp.xsd 
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-current.xsd 
http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd 
http://www.mulesoft.org/schema/mule/jasperengine http://www.mulesoft.org/schema/mule/jasperengine/current/mule-jasperengine.xsd ">
    <jasperengine:connector name="JEC" vendor="jasper" appName="cat010-client" version="1.0" deploymentId="jasperLab" jAppAuthKey="1c1c69e546ab42d69d00fdc6c3547d5f71d25552" jasperEngineURL="tcp://${cat010.client.jasperEngineURL.host}:${cat010.client.jasperEngineURL.port}" doc:name="JasperEngineConnector"/>
    <flow name="jApp-cat010-client-flow" doc:name="jApp-cat010-client-flow">
        <udp:inbound-endpoint host="${cat010.client.inbound.cat010endpoint.host}" port="${cat010.client.inbound.cat010endpoint.port}" responseTimeout="10000" doc:name="cat010InboundEndpoint"/>
        <all doc:name="All">
            <processor-chain>
            	<jasperengine:outbound-endpoint topic="jms.jasper.1.0.cat010.topic.byteArray" connector-ref="JEC" doc:name="JECAdapsEndpoint"/>
            </processor-chain>
            <processor-chain>
                <custom-transformer class="org.jasper.jLib.cat010.transformer.ByteArrayOrCat010WithOriginalByteArrayToCat010Message" doc:name="getCat010Message"/>
		        <choice doc:name="Choice">
		            <when expression="message.payload is org.jasper.jLib.cat010.codec.Cat010PeriodicStatusMessage">
		                <processor-chain>
		                    <jasperengine:outbound-endpoint topic="jms.jasper.1.0.cat010.topic.psm" connector-ref="JEC" doc:name="JECAdapsEndpoint"/>
		                </processor-chain>
		            </when>
		            <when expression="message.payload is org.jasper.jLib.cat010.codec.Cat010TargetReport">
		                <processor-chain>
		                    <jasperengine:outbound-endpoint topic="jms.jasper.1.0.cat010.topic.tr" connector-ref="JEC" doc:name="JECAdapsEndpoint"/>
		                </processor-chain>
		            </when>
		            <otherwise>
		                <processor-chain>
		                    <logger level="ERROR" doc:name="ErrorLogger"/>
		                </processor-chain>
		            </otherwise>
		        </choice>
            </processor-chain>
        </all>
    </flow>
</mule>
